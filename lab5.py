# lab5_metrics_titanic_3models.py 
# Lab 5: р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Юр╕Вр╕нр╕З 3 р╣Вр╕бр╣Ар╕Фр╕е: KNN, Naive Bayes, Decision Tree
# р╕Др╕│р╕Щр╕зр╕У Accuracy, Precision, Recall, F1-Score р╣Бр╕ер╕░р╣Бр╕кр╕Фр╕З Confusion Matrix
# р╣Гр╕Кр╣Й 5-fold cross-validation (р╣Бр╕Хр╣Ир╕ер╕░ fold р╕Чр╕Фр╕кр╕нр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕У 20%) р╕Бр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е Titanic

# ======== Import Libraries ========
from pathlib import Path  # р╣Др╕ер╕Ър╕гр╕▓р╕гр╕╡р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Др╕Яр╕ер╣Мр╕Юр╕▓р╕Шр╣Бр╕Ър╕Ъ cross-platform (Windows/Mac/Linux)
import pandas as pd  # р╣Др╕ер╕Ър╕гр╕▓р╕гр╕╡р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▓р╕гр╕▓р╕З (DataFrame) р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Вр╕лр╕ер╕Фр╣Бр╕ер╕░р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕е CSV
import numpy as np  # р╣Др╕ер╕Ър╕гр╕▓р╕гр╕╡р╕Др╕│р╕Щр╕зр╕Ур╕Чр╕▓р╕Зр╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣Мр╣Бр╕ер╕░р╕Ир╕▒р╕Фр╕Бр╕▓р╕г array

# Pipeline р╣Бр╕ер╕░ Preprocessing
from sklearn.compose import ColumnTransformer  # р╣Гр╕Кр╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕г preprocessing р╣Бр╕вр╕Бр╕Хр╕▓р╕бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Др╕нр╕ер╕▒р╕бр╕Щр╣М (р╕Хр╕▒р╕зр╣Ар╕ер╕В/р╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И)
from sklearn.pipeline import Pipeline  # р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Хр╣Ир╕▓р╕Зр╣Ж (preprocessing -> model) р╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Хр╕Цр╕╕р╣Ар╕Фр╕╡р╕вр╕з
from sklearn.preprocessing import OneHotEncoder, StandardScaler  # One-hot encoding р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И, StandardScaler р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕гр╕▒р╕Ър╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╣Ар╕ер╕В
from sklearn.impute import SimpleImputer  # р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕нр╣Ар╕Хр╕┤р╕бр╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╕лр╕▓р╕вр╣Др╕Ы (missing values)

# Machine Learning Models
from sklearn.neighbors import KNeighborsClassifier  # р╕нр╕▒р╕ер╕Бр╕нр╕гр╕┤р╕Шр╕╢р╕б K-Nearest Neighbors р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Ч
from sklearn.naive_bayes import GaussianNB  # р╕нр╕▒р╕ер╕Бр╕нр╕гр╕┤р╕Шр╕╢р╕б Gaussian Naive Bayes р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Ч
from sklearn.tree import DecisionTreeClassifier  # р╕нр╕▒р╕ер╕Бр╕нр╕гр╕┤р╕Шр╕╢р╕б Decision Tree р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Ч

# Cross-validation р╣Бр╕ер╕░ Evaluation
from sklearn.model_selection import StratifiedKFold  # р╣Бр╕Ър╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕Ър╕Ъ stratified k-fold (р╕гр╕▒р╕Бр╕йр╕▓р╕кр╕▒р╕Фр╕кр╣Ир╕зр╕Щр╕Др╕ер╕▓р╕кр╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░ fold)
from sklearn.metrics import (  # р╣Ар╕бр╕Хр╕гр╕┤р╕Бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Юр╣Бр╕ер╕░р╕кр╕гр╣Йр╕▓р╕З confusion matrix
    confusion_matrix,  # р╕кр╕гр╣Йр╕▓р╕Зр╕Хр╕▓р╕гр╕▓р╕З confusion matrix
    accuracy_score,    # р╕Др╕│р╕Щр╕зр╕У accuracy = (TP+TN)/(TP+TN+FP+FN)
    precision_score,   # р╕Др╕│р╕Щр╕зр╕У precision = TP/(TP+FP) 
    recall_score,      # р╕Др╕│р╕Щр╕зр╕У recall = TP/(TP+FN)
    f1_score          # р╕Др╕│р╕Щр╕зр╕У F1-score = 2*(precision*recall)/(precision+recall)
)

# ======== 1) р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Др╣Йр╕Щр╕лр╕▓р╣Бр╕ер╕░р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е ========
def find_train_csv():
    """
    р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Др╣Йр╕Щр╕лр╕▓р╣Др╕Яр╕ер╣М train.csv р╣Гр╕Щр╕лр╕ер╕▓р╕вр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Чр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щр╣Др╕Ыр╣Др╕Фр╣Й
    р╕ер╕│р╕Фр╕▒р╕Ър╕Бр╕▓р╕гр╕Др╣Йр╕Щр╕лр╕▓: р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ -> titanic_data/ -> data_titanic/
    
    Returns:
        str: р╕Юр╕▓р╕Шр╕Вр╕нр╕Зр╣Др╕Яр╕ер╣М train.csv р╕Чр╕╡р╣Ир╕Юр╕Ъ
        
    Raises:
        FileNotFoundError: р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕Юр╕Ър╣Др╕Яр╕ер╣М train.csv р╣Гр╕Щр╕Чр╕╕р╕Бр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Чр╕╡р╣Ир╕Бр╕│р╕лр╕Щр╕Ф
    """
    here = Path(".")  # р╕кр╕гр╣Йр╕▓р╕З Path object р╕Кр╕╡р╣Йр╣Др╕Ыр╕вр╕▒р╕Зр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ
    
    # р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Чр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щр╣Др╕Ыр╣Др╕Фр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Др╕Яр╕ер╣М train.csv
    possible_paths = [
        here / "train.csv",  # р╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣Ир╣Др╕Яр╕ер╣Мр╕нр╕вр╕╣р╣Ир╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Ър╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣М
        here / "titanic_data" / "train.csv",  # р╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣Ир╣Др╕Яр╕ер╣Мр╕нр╕вр╕╣р╣Ир╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М titanic_data
        here / "data_titanic" / "train.csv"   # р╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣Ир╣Др╕Яр╕ер╣Мр╕нр╕вр╕╣р╣Ир╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М data_titanic
    ]
    
    # р╕зр╕Щр╕ер╕╣р╕Ыр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕Хр╣Ир╕ер╕░р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕З
    for path in possible_paths:
        if path.exists():  # р╕Цр╣Йр╕▓р╕Юр╕Ър╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Щр╕╡р╣Й
            return str(path)  # р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╕Юр╕▓р╕Шр╣Ар╕Ыр╣Зр╕Щ string р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕Кр╣Йр╕Бр╕▒р╕Ъ pandas
    
    # р╕Цр╣Йр╕▓р╕зр╕Щр╕ер╕╣р╕Ыр╕Ир╕Ър╣Бр╕ер╣Йр╕зр╣Др╕бр╣Ир╕Юр╕Ър╣Др╕Яр╕ер╣Мр╣Гр╕Фр╣Ар╕ер╕в р╣Гр╕лр╣Йр╣Бр╕Ир╣Йр╕Зр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╕Юр╕гр╣Йр╕нр╕бр╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│
    raise FileNotFoundError(
        "р╣Др╕бр╣Ир╕Юр╕Ър╣Др╕Яр╕ер╣М train.csv р╕Бр╕гр╕╕р╕Ур╕▓р╕зр╕▓р╕Зр╣Др╕Яр╕ер╣Мр╣Гр╕Щр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Гр╕Фр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕лр╕Щр╕╢р╣Ир╕З:\n"
        "- р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ (train.csv)\n"
        "- р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М titanic_data/train.csv\n"  
        "- р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М data_titanic/train.csv"
    )

# ======== 2) р╣Вр╕лр╕ер╕Фр╣Бр╕ер╕░р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕е ========
print("ЁЯЪв р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е Titanic...")
csv_path = find_train_csv()  # р╣Ар╕гр╕╡р╕вр╕Бр╣Гр╕Кр╣Йр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╕лр╕▓р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Др╕Яр╕ер╣М
df = pd.read_csv(csv_path)  # р╕нр╣Ир╕▓р╕Щр╣Др╕Яр╕ер╣М CSV р╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╣Ар╕Ыр╣Зр╕Щ pandas DataFrame

print(f"тЬЕ р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕Ир╕Ир╕▓р╕Б: {csv_path}")
print(f"ЁЯУК р╕Вр╕Щр╕▓р╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е: {df.shape[0]} р╣Бр╕Цр╕з, {df.shape[1]} р╕Др╕нр╕ер╕▒р╕бр╕Щр╣М")

# ======== Feature Engineering ========
# р╕кр╕гр╣Йр╕▓р╕Зр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╣Гр╕лр╕бр╣Ир╕Ир╕▓р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕бр╕╡р╕нр╕вр╕╣р╣И
df["FamilySize"] = df["SibSp"] + df["Parch"] + 1  # р╕Вр╕Щр╕▓р╕Фр╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з = р╕Юр╕╡р╣Ир╕Щр╣Йр╕нр╕Зр╕Др╕╣р╣Ир╕кр╕бр╕гр╕к + р╕Юр╣Ир╕нр╣Бр╕бр╣Ир╕ер╕╣р╕Б + р╕Хр╕▒р╕зр╣Ар╕нр╕З
df["IsAlone"] = (df["FamilySize"] == 1).astype(int)  # р╣Ар╕Фр╕┤р╕Щр╕Чр╕▓р╕Зр╕Др╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И (1=р╕Др╕Щр╣Ар╕Фр╕╡р╕вр╕з, 0=р╕бр╕╡р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з)

# р╕Бр╕│р╕лр╕Щр╕Фр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕╡р╣Ир╕Ир╕░р╣Гр╕Кр╣Йр╣Гр╕Щр╕Бр╕▓р╕гр╕Эр╕╢р╕Бр╣Вр╕бр╣Ар╕Фр╕е
features = [
    "Pclass",     # р╕Кр╕▒р╣Йр╕Щр╕Вр╕нр╕Зр╕Хр╕▒р╣Лр╕з (1=first class, 2=second class, 3=third class)
    "Sex",        # р╣Ар╕Юр╕и (male/female)
    "Age",        # р╕нр╕▓р╕вр╕╕
    "SibSp",      # р╕Ир╕│р╕Щр╕зр╕Щр╕Юр╕╡р╣Ир╕Щр╣Йр╕нр╕З/р╕Др╕╣р╣Ир╕кр╕бр╕гр╕кр╕Ър╕Щр╣Ар╕гр╕╖р╕н
    "Parch",      # р╕Ир╕│р╕Щр╕зр╕Щр╕Юр╣Ир╕нр╣Бр╕бр╣И/р╕ер╕╣р╕Бр╕Ър╕Щр╣Ар╕гр╕╖р╕н
    "Fare",       # р╕Др╣Ир╕▓р╕Хр╕▒р╣Лр╕з
    "Embarked",   # р╕Чр╣Ир╕▓р╣Ар╕гр╕╖р╕нр╕Чр╕╡р╣Ир╕Вр╕╢р╣Йр╕Щ (C=Cherbourg, Q=Queenstown, S=Southampton)
    "FamilySize", # р╕Вр╕Щр╕▓р╕Фр╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з (р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣И)
    "IsAlone"     # р╣Ар╕Фр╕┤р╕Щр╕Чр╕▓р╕Зр╕Др╕Щр╣Ар╕Фр╕╡р╕вр╕з (р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣И)
]

target = "Survived"  # р╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕в (0=р╣Др╕бр╣Ир╕гр╕нр╕Ф, 1=р╕гр╕нр╕Ф)

# р╣Бр╕вр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е input (X) р╣Бр╕ер╕░ output (y)
X = df[features].copy()  # р╕Др╕▒р╕Фр╕ер╕нр╕Бр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Бр╕бр╕▓р╣Ар╕Ыр╣Зр╕Щ input features
y = df[target].copy()    # р╕Др╕▒р╕Фр╕ер╕нр╕Бр╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕вр╕бр╕▓р╣Ар╕Ыр╣Зр╕Щ target labels

print(f"ЁЯОп р╣Гр╕Кр╣Йр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф {len(features)} р╕Хр╕▒р╕з: {features}")
print(f"ЁЯУИ р╕Бр╕▓р╕гр╕Бр╕гр╕░р╕Ир╕▓р╕вр╕Вр╕нр╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М:")
print(f"   - р╕гр╕нр╕Фр╕Кр╕╡р╕зр╕┤р╕Х (1): {y.sum()} р╕Др╕Щ ({y.mean()*100:.1f}%)")
print(f"   - р╣Ар╕кр╕╡р╕вр╕Кр╕╡р╕зр╕┤р╕Х (0): {len(y)-y.sum()} р╕Др╕Щ ({(1-y.mean())*100:.1f}%)")

# ======== 3) р╣Бр╕вр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕кр╕│р╕лр╕гр╕▒р╕Ъ Preprocessing ========
# р╣Бр╕вр╕Бр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Хр╕▓р╕бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕Кр╣Йр╕зр╕┤р╕Шр╕╡ preprocessing р╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
numerical_features = ["Age", "SibSp", "Parch", "Fare", "FamilySize", "IsAlone"]  # р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щр╕Хр╕▒р╕зр╣Ар╕ер╕В
categorical_features = ["Pclass", "Sex", "Embarked"]  # р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И

print(f"ЁЯФв р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Хр╕▒р╕зр╣Ар╕ер╕В: {numerical_features}")
print(f"ЁЯУВ р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И: {categorical_features}")

# ======== 4) р╕кр╕гр╣Йр╕▓р╕З Preprocessing Pipeline ========

# Pipeline р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╣Ар╕ер╕В
numerical_transformer = Pipeline(steps=[
    # р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 1: р╣Ар╕Хр╕┤р╕бр╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╕лр╕▓р╕вр╣Др╕Ыр╕Фр╣Йр╕зр╕вр╕Др╣Ир╕▓р╕бр╕▒р╕Шр╕вр╕Рр╕▓р╕Щ (median) р╕Чр╕│р╣Гр╕лр╣Йр╕Чр╕Щр╕Чр╕▓р╕Щр╕Хр╣Ир╕н outliers
    ("imputer", SimpleImputer(strategy="median")),
    # р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 2: р╕Ыр╕гр╕▒р╕Ър╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е (mean=0, std=1) р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╣Бр╕Хр╣Ир╕ер╕░р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕бр╕╡р╕кр╣Ар╕Бр╕ер╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
    ("scaler", StandardScaler())
])

# Pipeline р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И  
categorical_transformer = Pipeline(steps=[
    # р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 1: р╣Ар╕Хр╕┤р╕бр╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╕лр╕▓р╕вр╣Др╕Ыр╕Фр╣Йр╕зр╕вр╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╕Юр╕Ър╕Ър╣Ир╕нр╕вр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф (mode)
    ("imputer", SimpleImputer(strategy="most_frequent")),
    # р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 2: р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ One-Hot Encoding (р╣Бр╕Ыр╕ер╕Зр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣Ир╣Ар╕Ыр╣Зр╕Щр╣Ар╕зр╕Бр╣Ар╕Хр╕нр╕гр╣М binary)
    ("onehot", OneHotEncoder(handle_unknown="ignore"))  # ignore = р╕Вр╣Йр╕▓р╕бр╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╣Др╕бр╣Ир╣Ар╕Др╕вр╣Ар╕лр╣Зр╕Щр╕Хр╕нр╕Щр╣Ар╕Чр╕гр╕Щ
])

# р╕гр╕зр╕б Pipeline р╕Чр╕▒р╣Йр╕Зр╕кр╕нр╕Зр╣Ар╕Вр╣Йр╕▓р╕Фр╣Йр╕зр╕вр╕Бр╕▒р╕Щ
preprocessor = ColumnTransformer(
    transformers=[
        ("num", numerical_transformer, numerical_features),    # р╣Гр╕Кр╣Й numerical_transformer р╕Бр╕▒р╕Ър╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Хр╕▒р╕зр╣Ар╕ер╕В
        ("cat", categorical_transformer, categorical_features) # р╣Гр╕Кр╣Й categorical_transformer р╕Бр╕▒р╕Ър╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И
    ]
)

# ======== 5) р╕Бр╕│р╕лр╕Щр╕Фр╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕▒р╣Йр╕З 3 р╕Хр╕▒р╕з ========

# р╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕╡р╣И 1: K-Nearest Neighbors (KNN)
knn_model = Pipeline(steps=[
    ("preprocessor", preprocessor),  # р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щ preprocessing
    ("classifier", KNeighborsClassifier(
        n_neighbors=5,    # р╣Гр╕Кр╣Й 5 р╣Ар╕Юр╕╖р╣Ир╕нр╕Щр╕Ър╣Йр╕▓р╕Щр╣Гр╕Бр╕ер╣Йр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕И
        weights="uniform", # р╕Цр╣Ир╕зр╕Зр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╣Ар╕Чр╣Ир╕▓р╕Бр╕▒р╕Щр╕Чр╕╕р╕Бр╣Ар╕Юр╕╖р╣Ир╕нр╕Щр╕Ър╣Йр╕▓р╕Щ (р╣Др╕бр╣Ир╕Др╕│р╕Щр╕╢р╕Зр╕гр╕░р╕вр╕░р╕Чр╕▓р╕З)
        p=2               # р╣Гр╕Кр╣Йр╕гр╕░р╕вр╕░р╕Чр╕▓р╕З Euclidean (L2 distance)
    ))
])

# р╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕╡р╣И 2: Gaussian Naive Bayes
nb_model = Pipeline(steps=[
    ("preprocessor", preprocessor),  # р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щ preprocessing р╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
    ("classifier", GaussianNB(
        # GaussianNB р╣Др╕бр╣Ир╕бр╕╡р╕Юр╕▓р╕гр╕▓р╕бр╕┤р╣Ар╕Хр╕нр╕гр╣Мр╕лр╕ер╕▒р╕Бр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Ыр╕гр╕▒р╕Ъ
        # р╕кр╕бр╕бр╕Хр╕┤р╕зр╣Ир╕▓р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╣Бр╕Хр╣Ир╕ер╕░р╕Хр╕▒р╕зр╕бр╕╡р╕Бр╕▓р╕гр╕Бр╕гр╕░р╕Ир╕▓р╕вр╣Бр╕Ър╕Ъ Gaussian р╣Бр╕ер╕░р╣Ар╕Ыр╣Зр╕Щр╕нр╕┤р╕кр╕гр╕░р╕Хр╣Ир╕нр╕Бр╕▒р╕Щ
    ))
])

# р╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕╡р╣И 3: Decision Tree  
dt_model = Pipeline(steps=[
    ("preprocessor", preprocessor),  # р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щ preprocessing р╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
    ("classifier", DecisionTreeClassifier(
        random_state=42,      # р╕Бр╕│р╕лр╕Щр╕Ф random seed р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕│р╕Лр╣Йр╕│р╣Др╕Фр╣Й
        max_depth=10,         # р╕Ир╕│р╕Бр╕▒р╕Фр╕Др╕зр╕▓р╕бр╕ер╕╢р╕Бр╕Вр╕нр╕Зр╕Хр╣Йр╕Щр╣Др╕бр╣Йр╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щ overfitting
        min_samples_split=20, # р╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 20 р╕Хр╕▒р╕зр╕Ир╕╢р╕Зр╕Ир╕░р╣Бр╕вр╕Б node р╣Др╕Фр╣Й
        min_samples_leaf=10   # р╣Бр╕Хр╣Ир╕ер╕░ leaf р╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 10 р╕Хр╕▒р╕з
    ))
])

# р╣Ар╕Бр╣Зр╕Ър╣Вр╕бр╣Ар╕Фр╕ер╣Бр╕ер╕░р╕Кр╕╖р╣Ир╕нр╣Др╕зр╣Йр╣Гр╕Щ dictionary р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕░р╕Фр╕зр╕Бр╣Гр╕Щр╕Бр╕▓р╕гр╕зр╕Щр╕ер╕╣р╕Ы
models = {
    "KNN": knn_model,
    "Naive Bayes": nb_model,
    "Decision Tree": dt_model
}

print(f"ЁЯдЦ р╣Ар╕Хр╕гр╕╡р╕вр╕бр╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф {len(models)} р╕Хр╕▒р╕з: {list(models.keys())}")

# ======== 6) р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Cross-Validation ========
# р╣Гр╕Кр╣Й Stratified K-Fold р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕▒р╕Бр╕йр╕▓р╕кр╕▒р╕Фр╕кр╣Ир╕зр╕Щр╕Вр╕нр╕Зр╣Бр╕Хр╣Ир╕ер╕░р╕Др╕ер╕▓р╕кр╣Гр╕Щр╕Чр╕╕р╕Б fold
cv = StratifiedKFold(
    n_splits=5,        # р╣Бр╕Ър╣Ир╕Зр╣Ар╕Ыр╣Зр╕Щ 5 р╕кр╣Ир╕зр╕Щ (р╣Бр╕Хр╣Ир╕ер╕░ fold р╣Гр╕Кр╣Й 20% р╣Ар╕Ыр╣Зр╕Щр╕Кр╕╕р╕Фр╕Чр╕Фр╕кр╕нр╕Ъ)
    shuffle=True,      # р╕кр╕▒р╕Ър╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╣Ир╕нр╕Щр╣Бр╕Ър╣Ир╕З
    random_state=42    # р╕Бр╕│р╕лр╕Щр╕Ф random seed р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕│р╕Лр╣Йр╕│р╣Др╕Фр╣Й
)

print(f"ЁЯУЛ р╣Гр╕Кр╣Й {cv.n_splits}-Fold Cross-Validation (р╣Бр╕Хр╣Ир╕ер╕░ fold р╕Чр╕Фр╕кр╕нр╕Ъ ~{100/cv.n_splits:.0f}%)")

# ======== 7) р╣Ар╕гр╕╡р╕вр╕Бр╣Гр╕Кр╣Й Cross-Validation р╣Бр╕ер╕░р╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Ьр╕е ========

# Dictionary р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╣Зр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Вр╕нр╕Зр╣Бр╕Хр╣Ир╕ер╕░р╣Вр╕бр╣Ар╕Фр╕е
all_results = {}

print("\n" + "="*80)
print("ЁЯОп р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Юр╣Бр╕Хр╣Ир╕ер╕░р╣Вр╕бр╣Ар╕Фр╕е")
print("="*80)

# р╕зр╕Щр╕ер╕╣р╕Ыр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╣Бр╕Хр╣Ир╕ер╕░р╣Вр╕бр╣Ар╕Фр╕е
for model_name, model in models.items():
    print(f"\nЁЯФД р╕Бр╕│р╕ер╕▒р╕Зр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щ {model_name}...")
    
    # р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Ар╕Бр╣Зр╕Ър╣Ар╕бр╕Хр╕гр╕┤р╕Бр╕Вр╕нр╕Зр╣Бр╕Хр╣Ир╕ер╕░ fold р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Вр╕бр╣Ар╕Фр╕ер╕Щр╕╡р╣Й
    fold_metrics = []
    
    # р╕зр╕Щр╕ер╕╣р╕Ыр╣Бр╕Хр╣Ир╕ер╕░ fold р╣Гр╕Щ cross-validation
    for fold_idx, (train_idx, test_idx) in enumerate(cv.split(X, y), start=1):
        # р╣Бр╕Ър╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▓р╕б index р╕Чр╕╡р╣Ир╣Др╕Фр╣Йр╕Ир╕▓р╕Б cross-validation
        X_train, X_test = X.iloc[train_idx], X.iloc[test_idx]  # р╣Бр╕Ър╣Ир╕Зр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣М
        y_train, y_test = y.iloc[train_idx], y.iloc[test_idx]  # р╣Бр╕Ър╣Ир╕Зр╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕в
        
        # р╕Эр╕╢р╕Бр╣Вр╕бр╣Ар╕Фр╕ер╕Фр╣Йр╕зр╕вр╕Кр╕╕р╕Фр╕Эр╕╢р╕Б
        model.fit(X_train, y_train)
        
        # р╕Чр╕│р╕Щр╕▓р╕вр╕Ьр╕ер╕Фр╣Йр╕зр╕вр╕Кр╕╕р╕Фр╕Чр╕Фр╕кр╕нр╕Ъ
        y_pred = model.predict(X_test)
        
        # р╕кр╕гр╣Йр╕▓р╕З confusion matrix (р╣Бр╕Цр╕з=р╕Др╣Ир╕▓р╕Ир╕гр╕┤р╕З, р╕Др╕нр╕ер╕▒р╕бр╕Щр╣М=р╕Др╣Ир╕▓р╕Чр╕│р╕Щр╕▓р╕в)
        cm = confusion_matrix(y_test, y_pred, labels=[0, 1])
        # р╣Бр╕Ыр╕ер╕З confusion matrix р╣Ар╕Ыр╣Зр╕Щ DataFrame р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕нр╣Ир╕▓р╕Щр╕Зр╣Ир╕▓р╕в
        cm_df = pd.DataFrame(
            cm, 
            index=["Actual: Not Survived (0)", "Actual: Survived (1)"],      # р╣Бр╕Цр╕з = р╕Др╣Ир╕▓р╕Ир╕гр╕┤р╕З
            columns=["Predicted: Not Survived (0)", "Predicted: Survived (1)"] # р╕Др╕нр╕ер╕▒р╕бр╕Щр╣М = р╕Др╣Ир╕▓р╕Чр╕│р╕Щр╕▓р╕в
        )
        
        # р╕Др╕│р╕Щр╕зр╕Ур╣Ар╕бр╕Хр╕гр╕┤р╕Бр╕Хр╣Ир╕▓р╕Зр╣Ж р╣Вр╕Фр╕вр╕Бр╕│р╕лр╕Щр╕Фр╣Гр╕лр╣Йр╕Др╕ер╕▓р╕к 1 (Survived) р╣Ар╕Ыр╣Зр╕Щ positive class
        accuracy = accuracy_score(y_test, y_pred)  # р╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│р╣Вр╕Фр╕вр╕гр╕зр╕б
        precision = precision_score(y_test, y_pred, pos_label=1, zero_division=0)  # р╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│р╕Вр╕нр╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕в "р╕гр╕нр╕Ф"
        recall = recall_score(y_test, y_pred, pos_label=1, zero_division=0)     # р╕Др╕зр╕▓р╕бр╕Др╕гр╕нр╕Ър╕Др╕ер╕╕р╕бр╕Вр╕нр╕Зр╕Бр╕▓р╕гр╕лр╕▓ "р╕Ьр╕╣р╣Йр╕гр╕нр╕Ф" р╕Чр╕╡р╣Ир╣Бр╕Чр╣Йр╕Ир╕гр╕┤р╕З
        f1 = f1_score(y_test, y_pred, pos_label=1, zero_division=0)            # р╕Др╣Ир╕▓р╣Ар╕Йр╕ер╕╡р╣Ир╕вр╕ор╕▓р╕гр╣Мр╣Вр╕бр╕Щр╕┤р╕Бр╕Вр╕нр╕З precision р╣Бр╕ер╕░ recall
        
        # р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Вр╕нр╕З fold р╕Щр╕╡р╣Й
        print(f"\n--- {model_name} - Fold {fold_idx} ---")
        print("ЁЯУК Confusion Matrix:")
        print(cm_df.to_string())
        print(f"ЁЯОп Accuracy : {accuracy*100:.1f}%")   # р╣Бр╕кр╕Фр╕Зр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Ыр╕нр╕гр╣Мр╣Ар╕Лр╣Зр╕Щр╕Хр╣М
        print(f"ЁЯФН Precision: {precision*100:.1f}%")  # р╣Гр╕Щ 100 р╕Др╕Щр╕Чр╕╡р╣Ир╕Чр╕│р╕Щр╕▓р╕вр╕зр╣Ир╕▓р╕гр╕нр╕Ф р╕бр╕╡р╕Бр╕╡р╣Ир╕Др╕Щр╕гр╕нр╕Фр╕Ир╕гр╕┤р╕З
        print(f"ЁЯУИ Recall   : {recall*100:.1f}%")     # р╣Гр╕Щ 100 р╕Др╕Щр╕Чр╕╡р╣Ир╕гр╕нр╕Фр╕Ир╕гр╕┤р╕З р╕Чр╕│р╕Щр╕▓р╕вр╕Цр╕╣р╕Бр╣Др╕Фр╣Йр╕Бр╕╡р╣Ир╕Др╕Щ  
        print(f"тЪЦя╕П  F1-Score : {f1*100:.1f}%")        # р╕Др╣Ир╕▓р╕кр╕бр╕Фр╕╕р╕ер╕гр╕░р╕лр╕зр╣Ир╕▓р╕З precision р╣Бр╕ер╕░ recall
        
        # р╣Ар╕Бр╣Зр╕Ър╣Ар╕бр╕Хр╕гр╕┤р╕Бр╕Вр╕нр╕З fold р╕Щр╕╡р╣Й
        fold_metrics.append({
            'Accuracy': accuracy,
            'Precision': precision, 
            'Recall': recall,
            'F1-Score': f1
        })
    
    # р╣Ар╕Бр╣Зр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Вр╕нр╕Зр╣Вр╕бр╣Ар╕Фр╕ер╕Щр╕╡р╣Й
    all_results[model_name] = fold_metrics

# ======== 8) р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ъ ========

print("\n" + "="*80)
print("ЁЯУК р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕Бр╕▓р╕гр╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Чр╕▒р╣Йр╕З 3 р╣Вр╕бр╣Ар╕Фр╕е")
print("="*80)

# р╕кр╕гр╣Йр╕▓р╕Зр╕Хр╕▓р╕гр╕▓р╕Зр╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
summary_data = []

for model_name, metrics_list in all_results.items():
    # р╣Бр╕Ыр╕ер╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Ар╕бр╕Хр╕гр╕┤р╕Бр╣Ар╕Ыр╣Зр╕Щ DataFrame
    df_metrics = pd.DataFrame(metrics_list)
    
    # р╕Др╕│р╕Щр╕зр╕Ур╕Др╣Ир╕▓р╣Ар╕Йр╕ер╕╡р╣Ир╕вр╣Бр╕ер╕░р╕кр╣Ир╕зр╕Щр╣Ар╕Ър╕╡р╕вр╕Зр╣Ар╕Ър╕Щр╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щ
    means = df_metrics.mean()
    stds = df_metrics.std(ddof=1)  # р╣Гр╕Кр╣Й sample standard deviation
    
    # р╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕▓р╕гр╕▓р╕Зр╕кр╕гр╕╕р╕Ы
    summary_data.append({
        'Model': model_name,
        'Accuracy (%)': f"{means['Accuracy']*100:.1f} ┬▒ {stds['Accuracy']*100:.1f}",
        'Precision (%)': f"{means['Precision']*100:.1f} ┬▒ {stds['Precision']*100:.1f}",  
        'Recall (%)': f"{means['Recall']*100:.1f} ┬▒ {stds['Recall']*100:.1f}",
        'F1-Score (%)': f"{means['F1-Score']*100:.1f} ┬▒ {stds['F1-Score']*100:.1f}"
    })
    
    # р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Вр╕нр╕Зр╣Бр╕Хр╣Ир╕ер╕░р╣Вр╕бр╣Ар╕Фр╕е
    print(f"\nЁЯдЦ {model_name}:")
    print(f"   ЁЯУИ Accuracy : {means['Accuracy']*100:.1f}% (┬▒{stds['Accuracy']*100:.1f}%)")
    print(f"   ЁЯФН Precision: {means['Precision']*100:.1f}% (┬▒{stds['Precision']*100:.1f}%)")
    print(f"   ЁЯУК Recall   : {means['Recall']*100:.1f}% (┬▒{stds['Recall']*100:.1f}%)")
    print(f"   тЪЦя╕П  F1-Score : {means['F1-Score']*100:.1f}% (┬▒{stds['F1-Score']*100:.1f}%)")

# р╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕ер╕░р╣Бр╕кр╕Фр╕Зр╕Хр╕▓р╕гр╕▓р╕Зр╕кр╕гр╕╕р╕Ы
summary_df = pd.DataFrame(summary_data)
print(f"\nЁЯУЛ р╕Хр╕▓р╕гр╕▓р╕Зр╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕Бр╕▓р╕гр╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ъ:")
print("=" * 90)
print(summary_df.to_string(index=False))

# ======== 9) р╕лр╕▓р╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕╡р╣Ир╕Фр╕╡р╕Чр╕╡р╣Ир╕кр╕╕р╕Ф ========
print(f"\nЁЯПЖ р╕Бр╕▓р╕гр╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Ю:")

# р╕лр╕▓р╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕╡р╣Ир╕Фр╕╡р╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░р╣Ар╕бр╕Хр╕гр╕┤р╕Б
best_models = {}
for metric in ['Accuracy', 'Precision', 'Recall', 'F1-Score']:
    best_score = -1
    best_model = ""
    
    for model_name, metrics_list in all_results.items():
        df_metrics = pd.DataFrame(metrics_list)
        avg_score = df_metrics[metric].mean()
        
        if avg_score > best_score:
            best_score = avg_score
            best_model = model_name
    
    best_models[metric] = (best_model, best_score)
    print(f"   ЁЯеЗ {metric} р╕Чр╕╡р╣Ир╕Фр╕╡р╕Чр╕╡р╣Ир╕кр╕╕р╕Ф: {best_model} ({best_score*100:.1f}%)")

print(f"\nЁЯТб р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│:")
print(f"   - р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│р╣Вр╕Фр╕вр╕гр╕зр╕бр╕кр╕╣р╕Зр╕кр╕╕р╕Ф: р╣Гр╕Кр╣Й {best_models['Accuracy'][0]}")
print(f"   - р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕вр╕Ьр╕┤р╕Ф 'р╕гр╕нр╕Ф': р╣Гр╕Кр╣Й {best_models['Precision'][0]}")  
print(f"   - р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕лр╕▓р╕Ьр╕╣р╣Йр╕гр╕нр╕Фр╣Гр╕лр╣Йр╣Др╕Фр╣Йр╕бр╕▓р╕Бр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф: р╣Гр╕Кр╣Й {best_models['Recall'][0]}")
print(f"   - р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Др╕зр╕▓р╕бр╕кр╕бр╕Фр╕╕р╕е: р╣Гр╕Кр╣Й {best_models['F1-Score'][0]}")

print(f"\nтЬЕ р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щр╣Бр╕ер╣Йр╕з!")